<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House Bill Search | Cherlynn Stevenson</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-blue': '#1C75BA', // Primary Blue 
                        'brand-gray': '#B5B5B5', // Primary Gray 
                        'brand-black': '#000000', // Primary Black 
                        'brand-white': '#FFFFFF', // Primary White 
                    },
                    fontFamily: {
                        // Impact for Headlines 
                        'headline': ['Impact', 'Haettenschweiler', 'Arial Narrow Bold', 'sans-serif'],
                        // DIN 2014 Narrow substitute 
                        'sans': ['"DIN 2014 Narrow"', '"Barlow Condensed"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #1C75BA; border-radius: 10px; }
    </style>
</head>
<body class="bg-brand-white text-brand-black min-h-screen font-sans">

    <header class="bg-brand-white border-b-4 border-brand-blue py-10 shadow-sm">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-end gap-4">
            <div>
                <h1 class="text-5xl font-headline tracking-tight text-brand-blue uppercase leading-none">
                    Cherlynn Stevenson
                </h1>
                <p class="text-brand-gray text-lg font-bold tracking-widest mt-2 uppercase">
                    House Bill Tracking Portal (2019-2024)
                </p>
            </div>
            <div id="lastUpdated" class="text-[10px] font-bold text-brand-gray border-2 border-brand-gray px-3 py-1 uppercase tracking-widest">
                Syncing Data...
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12">
        
        <div class="bg-white p-8 mb-12 border-2 border-brand-gray shadow-[8px_8px_0px_0px_rgba(28,117,186,0.1)]">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-2">
                    <label class="block text-xs font-bold text-brand-blue uppercase tracking-[0.2em] mb-3">Search Database</label>
                    <input type="text" id="searchInput" placeholder="Keywords, bill numbers, or topics..." 
                        class="w-full px-5 py-3 border-2 border-brand-black rounded-none focus:bg-blue-50 focus:border-brand-blue outline-none transition-all font-bold uppercase placeholder:text-brand-gray" />
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-brand-blue uppercase tracking-[0.2em] mb-3">Filter Category</label>
                    <div class="relative">
                        <select id="categoryFilter" class="w-full px-5 py-3 border-2 border-brand-black rounded-none focus:border-brand-blue outline-none bg-white font-bold uppercase appearance-none cursor-pointer">
                            <option value="">All Categories</option>
                        </select>
                        <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none text-brand-blue">
                            ▼
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="border-b-4 border-brand-black">
                        <th class="px-4 py-3 text-xs font-bold uppercase tracking-widest text-brand-blue">Session</th>
                        <th class="px-4 py-3 text-xs font-bold uppercase tracking-widest text-brand-blue">Bill #</th>
                        <th class="px-4 py-3 text-xs font-bold uppercase tracking-widest text-brand-blue">Description</th>
                        <th class="px-4 py-3 text-right text-xs font-bold uppercase tracking-widest text-brand-blue">Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>

        <footer class="mt-24 py-12 border-t-2 border-brand-gray flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-[10px] font-bold text-brand-gray uppercase tracking-[0.3em]">
                Paid for by Cherlynn Stevenson For Congress 
            </div>
            <div class="text-[10px] font-bold text-brand-gray uppercase tracking-[0.3em]">
                © 2024 All Rights Reserved
            </div>
        </footer>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        let billData = [];
        const CSV_URL = 'data.csv'; 

        async function fetchLastUpdated() {
            try {
                const pathParts = window.location.pathname.split('/').filter(p => p);
                const user = window.location.hostname.split('.')[0];
                const repo = pathParts[0] || ''; 
                if (!repo) return;
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/commits?path=data.csv&per_page=1`);
                const commits = await response.json();
                if (commits && commits.length > 0) {
                    const date = new Date(commits[0].commit.committer.date);
                    document.getElementById('lastUpdated').innerText = `Updated: ${date.toLocaleDateString()}`;
                }
            } catch (e) {
                document.getElementById('lastUpdated').innerText = 'Database Live';
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            fetchLastUpdated();
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    billData = results.data;
                    populateCategories(billData);
                    filterAndRender();
                }
            });
        });

        function populateCategories(data) {
            const catSelect = document.getElementById('categoryFilter');
            let categories = new Set();
            data.forEach(row => {
                if (row['Index Categories']) {
                    row['Index Categories'].split(/[;\n]/).forEach(p => {
                        const clean = p.trim();
                        if (clean.length > 2) categories.add(clean);
                    });
                }
            });
            Array.from(categories).sort().forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat; opt.textContent = cat;
                catSelect.appendChild(opt);
            });
        }

        function filterAndRender() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const selectedCat = document.getElementById('categoryFilter').value;

            const filtered = billData.filter(row => {
                const textMatch = Object.values(row).some(val => String(val).toLowerCase().includes(term));
                const catMatch = selectedCat === "" || (row['Index Categories'] && row['Index Categories'].includes(selectedCat));
                return textMatch && catMatch;
            });

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filtered.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-brand-gray hover:bg-blue-50 transition-colors";
                
                const billNum = row['Bill Number'] || row.Bill || 'N/A';
                const firstCat = (row['Index Categories'] || '').split(/[;\n]/)[0];

                tr.innerHTML = `
                    <td class="px-4 py-6 text-sm font-bold text-brand-gray">${row.Session || ''}</td>
                    <td class="px-4 py-6 text-lg font-bold text-brand-blue tracking-tighter">${billNum}</td>
                    <td class="px-4 py-6">
                        <div class="text-sm font-bold text-brand-black uppercase leading-tight mb-2">${row.Title || ''}</div>
                        <div class="inline-block text-[9px] font-bold text-brand-white bg-brand-gray px-2 py-0.5 uppercase tracking-widest">
                            ${firstCat || 'General'}
                        </div>
                    </td>
                    <td class="px-4 py-6 text-right">
                        <a href="${row.URL}" target="_blank" class="inline-block px-6 py-2 border-2 border-brand-blue text-brand-blue text-[10px] font-bold hover:bg-brand-blue hover:text-white transition-all uppercase tracking-[0.2em]">
                            View Bill
                        </a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('searchInput').addEventListener('input', filterAndRender);
        document.getElementById('categoryFilter').addEventListener('change', filterAndRender);
    </script>
</body>
</html>
